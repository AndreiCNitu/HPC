## Lattice Boltzmann timings

***
#### __Initial code__

+ `gcc -O3`

| Size      |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **Time**  | 58.8s          | 477s           | 2033s         |

***
#### __Compiler choice and flags__

+ `icc -Ofast`

| Size      |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **Time**  | 26.3s          | 212s           | 1010s         |

+ `icc -Ofast -xAVX -restrict -ansi-alias -qopenmp -qopt-report=5`

| Size      |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **Time**  | 25.1s         | 202s           | 921s           |

***
#### __Serial optimisations__

+ Merge `rebound()` and `collision()`

| Size      |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **Time**  | 24.8s         | 199s           | 940s          |

+ Merge `propagate()`, `rebound()`, `collision()`, `av_vels()`
+ Pointer swap in `timestep()`

| Size      |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **Time**  | 25.9s         | 208s           | 867s           |

+ Merge `propagate()`, `rebound()`, `collision()`, `av_vels()`
+ Pointer swap in `timestep()`
+ Store intermediate values in `const` vars -> 1 read + 1 write

| Size      |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **Time**  | 26.2s         | 211s           | 895s           |

***
#### __Vectorisation__

+ AoS -> SoA, aligned memory access, (some) `const`
+ Only `rebound()` and `collision()` are merged!

| Size      |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **Time**  | 12.74s        | 119s           | 649s           |

+ AoS -> SoA, `restrict`, all `const`, aligned data access
+ Pointer swap, 1 loop to rule them all
+ Store intermediate values in `const` vars -> 1 read + 1 write

| Size      |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **Time**  | 9.13s         | 69s            | 310s           |

***
#### __Parallel optimisations__

+ OpenMP `parallel for`, reductions

| Cores     |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **1**     | 8.79s         | 67.2s          | 314s           |
| **2**     | 4.64s         | 34.6s          | 158s           |
| **3**     | 3.35s         | 23.5s          | 108s           |
| **4**     | 2.61s         | 17.8s          | 87.2s          |
| **5**     | 2.35s         | 15.1s          | 73.5s          |
| **6**     | 2.07s         | 12.9s          | 69.9s          |
| **7**     | 1.83s         | 11.1s          | 64.5s          |
| **8**     | 1.61s         | 9.89s          | 68.6s          |
| **9**     | 1.60s         | 9.47s          | 70.6s          |
| **10**    | 1.64s         | 9.58s          | 66.5s          |
| **11**    | 1.74s         | 8.05s          | 68.0s          |
| **12**    | 1.67s         | 7.45s          | 65.3s          |
| **13**    | 1.58s         | 7.20s          | 63.6s          |
| **14**    | 1.45s         | 7.09s          | 62.0s          |
| **15**    | 1.57s         | 7.08s          | 64.8s          |
| **16**    | 1.43s         | 6.03s          | 73.2s          |

+ NUMA-aware implementation (parallel initialisation)
+ set `OMP_PROC_BIND=true`

| Cores     |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **1**     | 8.79s         | 68.4s          | 305s           |
| **2**     | 4.74s         | 34.7s          | 154s           |
| **3**     | 3.25s         | 23.4s          | 103s           |
| **4**     | 2.49s         | 17.7s          | 78.5s          |
| **5**     | 2.19s         | 15.5s          | 64.9s          |
| **6**     | 1.95s         | 12.6s          | 54.0s          |
| **7**     | 1.74s         | 11.0s          | 50.1s          |
| **8**     | 1.49s         | 9.58s          | 51.5s          |
| **9**     | 1.48s         | 8.91s          | 40.3s          |
| **10**    | 1.42s         | 8.21s          | 37.0s          |
| **11**    | 1.35s         | 7.74s          | 41.3s          |
| **12**    | 1.30s         | 7.03s          | 40.1s          |
| **13**    | 1.26s         | 6.80s          | 40.3s          |
| **14**    | 1.22s         | 6.44s          | 43.7s          |
| **15**    | 1.18s         | 6.17s          | 35.6s          |
| **16**    | 1.01s         | 5.75s          | 40.1s          |

+ NUMA-aware implementation (parallel initialisation)
+ set `OMP_PROC_BIND=true`
+ non-parallel `accelerate_flow()`

| Cores     |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **1**     | 8.77s         | 67.5s          | 304s           |
| **2**     | 4.66s         | 34.7s          | 155s           |
| **3**     | 3.14s         | 23.3s          | 103s           |
| **4**     | 2.43s         | 17.7s          | 79.3s          |
| **5**     | 2.06s         | 14.8s          | 65.1s          |
| **6**     | 1.80s         | 12.4s          | 58.7s          |
| **7**     | 1.56s         | 10.7s          | 52.0s          |
| **8**     | 1.41s         | 9.46s          | 51.7s          |
| **9**     | 1.33s         | 8.55s          | 50.1s          |
| **10**    | 1.20s         | 7.87s          | 49.6s          |
| **11**    | 1.17s         | 7.36s          | 49.0s          |
| **12**    | 1.08s         | 6.74s          | 48.4s          |
| **13**    | 1.04s         | 6.49s          | 45.2s          |
| **14**    | 0.992s        | 6.10s          | 43.7s          |
| **15**    | 0.962s        | 5.80s          | 42.0s          |
| **16**    | 0.891s        | 5.39s          | 39.1s          |

***
#### __Final times on 16 cores__

| Size      |  128 x 128    |  256 x 256     |  1024 x 1024   |
| --------- |:-------------:|:--------------:|:--------------:|
| **Time**  | 0.891s        | 5.39s          | 39.12s         |
