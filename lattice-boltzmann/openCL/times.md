## Lattice Boltzmann GPU timings

***
#### __Initial code__

+ `gcc -O3`
+ `-cl-opt-disable`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 76.4s     | 153.7s    | 617s      | 2419s       |

***
#### __Port rebound & collision to kernels__

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 48.0s     | 87s       | 300s      | 1200s       |

***
#### __Port av_vels to kernel, simple reduction in host__

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 56.4s     | 103s      | 418s      | 3097s       |

***
#### __Remove intermediate data transfers between host and device__

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 50.4s     | 97s       | 300s      | 735s        |

***
#### __Optimisation flags__

+ `icc -O3`
+ `-cl-strict-aliasing -cl-fast-relaxed-math`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 18.0s     | 28.5s     | 94s       | 314s        |

***
#### __All in one kernel__

+ `Code from optimised openMP version`
+ `Pointer swap`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 14.2s     | 21.9s     | 59s       | 166s        |

***
#### __AoS -> SoA__
+ `Add restricts to kernel`

+ `4 x 1`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 6.17s     | 10.2s     | 35.2      | 124s        |

+ `8 x 1`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 4.55s     | 6.80s     | 21.9      | 67s         |

+ `16 x 1`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 3.64s     | 4.98s     | 14.9      | 40s         |

+ `32 x 1`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 3.28s     | 4.24s     | 11.6      | 27.2s       |

+ `64 x 1`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 3.22s     | 3.98s     | 10.2      | 20.8s       |

+ `128 x 1`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 3.22s     | 3.98s     | 10.0      | 17.0s       |

+ `128 x 2`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 3.74s     | 5.19s     | 13.1      | 16.28s       |

+ `128 x 4`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 4.64s     | 6.98s     | 19.0s     | 24.6s       |

+ `128 x 8`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 6.72s     | 10.9s     | 31s       | 87s         |

***
#### __Misc__

+ `Remove clFinish after acc_flow`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.91s     | 3.66s     | 9.60s     | 20.8s       |

+ `Remove clFinish after combined kernel`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.70s     | 3.51s     | 9.01s     | 20.6s       |

+ `Remove malloc in each time step`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.61s     | 3.42s     | 8.97s     | 19.5s       |

***
#### __Reductions__

+ `128 x 1`

+ `Interleaved`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.99s     | 4.09s     | 11.3s     | 28.0s       |

+ `Contiguous`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.21s     | 2.68s     | 6.64s     | 13.1s       |

+ `Move partial sums final reduction at the end`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 0.888s    | 1.31s     | 4.00s     | 12.5s       |

+ `Precompute tot_cells`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 0.831s    | 1.26s     | 3.85s     | 12.1s       |

***
#### __Final times__

+ `NVIDIA Tesla K20m`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 0.821s    | 1.23s     | 3.79s     | 12.13s      |

+ `Intel Xeon E5-2670`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.96s     | 4.46s     | 13.4s     | 62s         |
