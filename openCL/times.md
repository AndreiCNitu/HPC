## Lattice Boltzmann GPU timings

***
#### __Initial code__

+ `gcc -O3`
+ `-cl-opt-disable`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 76.4s     | 153.7s    | 617s      | 2419s       |

***
#### __Port rebound & collision to kernels__

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 48.0s     | 87s       | 300s      | 1200s       |

***
#### __Port av_vels to kernel, simple reduction in host__

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 56.4s     | 103s      | 418s      | 3097s       |

***
#### __Remove intermediate data transfers between host and device__

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 50.4s     | 97s       | 300s      | 735s        |

***
#### __Optimisation flags__

+ `icc -O3`
+ `-cl-strict-aliasing -cl-fast-relaxed-math`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 18.0s     | 28.5s     | 94s       | 314s        |

***
#### __All in one kernel__

+ `Code from optimised openMP version`
+ `Pointer swap`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 14.2s     | 21.9s     | 59s       | 166s        |

***
#### __AoS -> SoA__

+ `16 x 16`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 13.7s     | 17.8s     | 50s       | 163s        |

+ `8 x 8`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 8.32s     | 14.0s     | 35.9s     | 121s        |

+ `1 x 64`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 9.95s     | 15.9s     | 47.4s     | 160s        |

+ `1 x 32`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 9.67s     | 14.1s     | 56.8s     | 188s        |

+ `128 x 1`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 8.30s     | 13.6s     | 48.8s     | 150s        |

+ `64 x 1`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 8.15s     | 13.6s     | 34.5s     | 115s        |

+ `32 x 1`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 8.19s     | 11.1s     | 47.4s     | 161s        |

+ `32 x 2`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 8.09s     | 13.6s     | 34.5s     | 115s        |

***
#### __Misc__

+ `64 x 1`

+ `Add restricts to kernel`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 3.23s     | 4.06s     | 10.4s     | 20.8s       |

+ `Remove clFinish after acc_flow`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.91s     | 3.66s     | 9.60s     | 20.8s       |

+ `Remove clFinish after combined kernel`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.70s     | 3.51s     | 9.01s     | 20.6s       |

+ `Remove malloc in each time step`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.61s     | 3.42s     | 8.97s     | 19.5s       |

***
#### __Reductions__

+ `128 x 1`

+ `Interleaved`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.99s     | 4.09s     | 11.3s     | 28.0s       |

+ `Contiguous`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 2.21s     | 2.68s     | 6.64s     | 13.1s       |

+ `Move partial sums final reduction at the end`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 0.888s    | 1.31s     | 4.00s     | 12.5s       |

+ `Precompute tot_cells`

| Size      | 128 x 128 | 128 x 256 | 256 x 256 | 1024 x 1024 |
| --------- |:---------:|:---------:|:---------:|:-----------:|
| **Time**  | 0.831s    | 1.26s     | 3.85s     | 12.1s       |
